# 6

分析带数据库的信息系统

![1](https://github.com/TJ-CSCCG/TJCS-Images/raw/TJCS-Course/100222_安全体系结构/doc/slides/6-1.png)

什么是数据库的安全？

从安全角度来看，至少有两个角度：

* 表明对数据的保护程度。防止非授权的访问、修改操作，防止被授权用户取走时半道截获。
* 需要对整个环境的完整理解。要把数据放在整个信息系统中考虑。

最简单的是单机的数据库，只有用户自己一个人用。大多数是数据库在远端，或者是用浏览器访问。

所以数据库主机内部会涉及到，终端用户也会涉及到，也会涉及数据库和终端间的通讯链路。

对于第一点，需要判断怎样的授权是被允许的。全生命周期对数据的保护程度。

对于第二点，是要全环节、全周期的保护程度。



保护的数据需要的保护等级不同，不同的数据类型，也有不同的参考，不同的数据带来的威胁也不同。这个之前经常提到的。



安全策略是支撑企业总策略的三大策略之一

![2](https://github.com/TJ-CSCCG/TJCS-Images/raw/TJCS-Course/100222_安全体系结构/doc/slides/6-2.png)

对这个企业，重要的核心数据，要准确。第二，不仅要准确，还要完整。从任何地方看到的和原本数据都要是相同的。（源一致）

带数据库的信息系统需要保证上面两方面。

信息系统会有一系列的软件、硬件、业务规则。从企业和组织的角度看，最重要的是保持业务的成功。



![4](https://github.com/TJ-CSCCG/TJCS-Images/raw/TJCS-Course/100222_安全体系结构/doc/slides/6-4.png)

一般的信息系统如何构成？

信息系统最终是保证商业目标的实现。

首先需要有数据。（数据未必是信息。data \neq information）

数据有结构化的、非结构化的、各种类型的。但是不都有用。有用的是信息。

？？迭代会涉及不同的系统，会涉及不同的信息系统。

比如tjdx开学的时候，买饭。一卡通有对应的售卡系统，进图书馆刷卡，都会用到 TPS 系统。在工业里面，生产线上，传统的感知、现场处理系统。

事务处理系统会上升到决策系统，之后会上升到专家系统。

在前端系统中，往往处理现场感知系统，处理一系列集成的数据。

往上是符号。在往上是语义和符号的。



![5](https://github.com/TJ-CSCCG/TJCS-Images/raw/TJCS-Course/100222_安全体系结构/doc/slides/6-5.png)

传统的TPS会有固定的，现在的TPS会和虚拟计算、云计算结合。以往的都是手持设备??? 现在的都是云端的虚拟的设备。？？？

数据对齐？？在线特征？？

每一个TPS实现一个具体的任务？？？

早期的TPS是对一个特定的任务？？现在可能会和后台的智能设施链接??

现场的文字处理？？？

面临一个特定的 TPS，分析它的特征，才能分析他的脆弱性。

比如一个TPS是本地处理，定时和系统对接，那么就不需要考虑链路的操作威胁。不需要考虑远端威胁。

如果要实施对准，那么要考虑远端威胁。

![6](https://github.com/TJ-CSCCG/TJCS-Images/raw/TJCS-Course/100222_安全体系结构/doc/slides/6-6.png)

中层和高层的系统不一样。

决策支持系统，典型的有：风险管理系统（不仅仅是IT，可能是银行的风控，对人和实体的评级）

解决非结构化问题，具有某种领域模型、专家经验，或者基于大量的统计分析。

专家系统，对于现实生活的各种虚拟化模拟，需要专家系统，比如量化投资管理、市场趋势分析判断、目标识别……

![7](https://github.com/TJ-CSCCG/TJCS-Images/raw/TJCS-Course/100222_安全体系结构/doc/slides/6-7.png)

无论是TPS,DSS,ES都会有传统的硬件、软件、网络组成。或许还有操作员和操作规则。这五个都是紧紧围绕数据的。

以数据为中心，包含硬软件、信息、网络的系统，进来的是数据，出去的是有用的信息。

做现场处理的时候，data是对世界的感知，有些是纯数字的，有些是纯符号的……如此，得到的info就是语义层面的。

![8](https://github.com/TJ-CSCCG/TJCS-Images/raw/TJCS-Course/100222_安全体系结构/doc/slides/6-8.png)

实现的时候需要分层。

一个好的软件体系结构分成三层，便于互操作，便于与第三方的模块集成，便于维护和更新。

实际上看到的信息系统的实现，未必都是三层的，可能是一层的。

从安全的角度来看，不同的分层策略和需要提供的安全策略、安全保护是不一样的。

无论是从业务处理逻辑，还是软件体系架构，三层是比较合理的。

它既是一个物理的概念，还是一个逻辑的概念。（即使是一层或者多层架构）

![6-9](https://github.com/TJ-CSCCG/TJCS-Images/raw/TJCS-Course/100222_安全体系结构/doc/slides/6-9.png)

一层、二层和三层。

这三种都可以实现业务模式，但是从业务安全保障的角度来讲，是完全不一样的。

从单机角度来说。无论是界面还是客户端，都在一个界面上面。从安全风险角度，如果一个用户是一个有缺陷的，是非授权用户，数据库是完全裸露的。除了业务逻辑调整很困难之外，没有分离和保护的措施。

大部分数据库大作业是用的二层。一旦要更新，程序的调整会变得麻烦。如果终端出了问题，那么数据库就是暴露的。

binis 服务器？有一个做应用服务的服务器。所有的用户不能直接访问后台的数据库，都是通过业务处理单元访问的，这意味着客户端和后台的数据库系统是隔离的。

（以前出过一个画了这三个图，考了一个设计怎样的安全服务来实现安全）



![10](https://github.com/TJ-CSCCG/TJCS-Images/raw/TJCS-Course/100222_安全体系结构/doc/slides/6-10.png)

无论是数据的处理，还是安全，都依靠DBMS。

重点中的重点是：数据的一致性和完整性，强烈依赖于DBMS。

如果是一个动态数据，甚至操作会带来变化的时候，如何保证一致性和完整性。

如何保证一致性，还能够协同工作。串行和并行的权衡。

第二点是，数据库策略要得到强力的执行。某些数据库有适当的安全策略，但是在某些需要它们的时刻，却不一定运行起来了。需要安全策略得到切实的执行。

![12](https://github.com/TJ-CSCCG/TJCS-Images/raw/TJCS-Course/100222_安全体系结构/doc/slides/6-12.png)

这是一个数据库。

![13](https://github.com/TJ-CSCCG/TJCS-Images/raw/TJCS-Course/100222_安全体系结构/doc/slides/6-13.png)

数据的保密性、可用性落实到管理的结构化数据库上，如何基于CIA三角衡量一个具有数据库管理平台的信息系统？

要考虑到整个信息系统的全生命周期，什么情况下能保护关心的数据？

（度量方法是 CIA）

第一，没办法做到 100%，一定要保证数据的效率和可用性。不能光强调安全，还有效率。兼顾是做不到。

数据库可能是实时动态变化的，并不是静态数据，那么如何衡量I和C。业务便捷性的100%安全是不可能的，一定要做平衡。

![14](https://github.com/TJ-CSCCG/TJCS-Images/raw/TJCS-Course/100222_安全体系结构/doc/slides/6-14.png)

本地的备份服务器，远程的数据库备份服务器。有多个副本。这个情况下如何考虑 CIA。

同样一个数据库系统，支撑的前端系统是不一样的。要可以基于web，基于终端……

![15](https://github.com/TJ-CSCCG/TJCS-Images/raw/TJCS-Course/100222_安全体系结构/doc/slides/6-15.png)

有不同类型的 sql 注入方法，也有不同的机制对应解决它们。

正常的浏览器，查询的东西一定是有限长的。

![16](https://github.com/TJ-CSCCG/TJCS-Images/raw/TJCS-Course/100222_安全体系结构/doc/slides/6-16.png)

![17](https://github.com/TJ-CSCCG/TJCS-Images/raw/TJCS-Course/100222_安全体系结构/doc/slides/6-17.png)

![18](https://github.com/TJ-CSCCG/TJCS-Images/raw/TJCS-Course/100222_安全体系结构/doc/slides/6-18.png)

基于CS架构和sqlserver都存在sql注入风险。sql注入不仅仅和sql版本有关，还和后方的平台有关，还和业务逻辑处理有关。

![19](https://github.com/TJ-CSCCG/TJCS-Images/raw/TJCS-Course/100222_安全体系结构/doc/slides/6-19.png)

有些补丁打上去，系统就跑不起来了。

第一种是把所有的sql注入方式全部检测，过滤。这个很困难，因为总结所有的注入方式不切实际。只能够根据已知的，即使是已知的，也很困难。

第二种是结合数据库访问控制。使得某些人不能够去查询某些数据库或者表。

第三种是把关键词随机化，让攻击者无法利用常见的关键字组织攻击。攻击者经常利用常识来攻击。

![20](https://github.com/TJ-CSCCG/TJCS-Images/raw/TJCS-Course/100222_安全体系结构/doc/slides/6-20.png)

非授权的实体看不到某些内容，即使看到了，看也看不懂。

数据库整体不可能加密，对于普通重要性的信息，不会这么干。但是对于特别特殊的信息，或许是会对某些字段加密，比如用户密码。

无法衡量一个经常变动的数据库的完整性。

数据库中的数据可以分级。

对于不同的数据，可以用不同的安全策略。

![21](https://github.com/TJ-CSCCG/TJCS-Images/raw/TJCS-Course/100222_安全体系结构/doc/slides/6-21.png)

防止非授权的访问。

基于重要性分类，来判断数据的暴露情况。disclosure。

分析敏感信息。

![22](https://github.com/TJ-CSCCG/TJCS-Images/raw/TJCS-Course/100222_安全体系结构/doc/slides/6-22.png)

需要保护的数据越少越好。保护对象越少越安全。

越需要保护的数据，所需要的各方面的控制和保护就越多。公开数据就没有。

（思考：带学生成绩的数据库，如何分级。）

